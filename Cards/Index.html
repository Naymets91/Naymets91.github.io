<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Flashcards Quiz</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h2 id="word"></h2>

    <!-- –ü—Ä–æ–≥—Ä–µ—Å-–±–∞—Ä -->
    <div class="progress-container">
      <div id="progress-bar"></div>
    </div>
    <p id="progress-text"></p>

    <!-- –í–∞—Ä—ñ–∞–Ω—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ -->
    <div id="options"></div>

    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <button id="skipBtn">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç–∏</button>
    <button id="resetBtn">–°–∫–∏–Ω—É—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏</button>
    <button id="modeBtn">–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–Ω–∞–Ω—å</button>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats">
      <p>‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π: <span id="score">0</span></p>
      <p>üìä –í—Å—å–æ–≥–æ —Å–ø—Ä–æ–±: <span id="attempts">0</span></p>
      <p>‚è≠Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ: <span id="skipped">0</span></p>
      <p>üéØ –£—Å–ø—ñ—à–Ω—ñ—Å—Ç—å: <span id="accuracy">0%</span></p>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç—É -->
    <div id="testResult" style="margin-top:20px; font-weight:bold;"></div>
  </div>

  <script>
    let words = [];
    let score = 0;
    let attempts = 0;
    let skipped = 0;
    let currentIndex = 0;
    let mode = "normal"; // normal –∞–±–æ test
    let testWords = [];
    let testIndex = 0;
    let testScore = 0;

    if (localStorage.getItem("quizStats")) {
      const stats = JSON.parse(localStorage.getItem("quizStats"));
      score = stats.score;
      attempts = stats.attempts;
      skipped = stats.skipped;
      currentIndex = stats.currentIndex || 0;
      updateStats();
      updateProgress();
    }

    fetch("words.json")
      .then(res => res.json())
      .then(data => {
        words = data;
        newQuestion();
      });

    function saveStats() {
      const stats = { score, attempts, skipped, currentIndex };
      localStorage.setItem("quizStats", JSON.stringify(stats));
    }

    function updateStats() {
      document.getElementById("score").textContent = score;
      document.getElementById("attempts").textContent = attempts;
      document.getElementById("skipped").textContent = skipped;
      let accuracy = attempts > 0 ? Math.round((score / attempts) * 100) : 0;
      document.getElementById("accuracy").textContent = accuracy + "%";
      saveStats();
    }

    function updateProgress() {
      const total = mode === "normal" ? words.length : testWords.length;
      const done = mode === "normal" ? currentIndex : testIndex;
      const percent = total > 0 ? Math.round((done / total) * 100) : 0;
      document.getElementById("progress-bar").style.width = percent + "%";
      document.getElementById("progress-text").textContent = `${done}/${total}`;
    }

    function newQuestion() {
      let word;
      if (mode === "normal") {
        word = words[Math.floor(Math.random() * words.length)];
      } else {
        if (testIndex >= testWords.length) {
          finishTest();
          return;
        }
        word = testWords[testIndex];
      }

      document.getElementById("word").textContent = word.en;

      let options = [word.ua];
      while (options.length < 4) {
        let random = words[Math.floor(Math.random() * words.length)].ua;
        if (!options.includes(random)) options.push(random);
      }
      options = options.sort(() => Math.random() - 0.5);

      const div = document.getElementById("options");
      div.innerHTML = "";
      options.forEach(opt => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.onclick = () => {
          attempts++;
          if (mode === "normal") currentIndex++;
          if (opt === word.ua) {
            score++;
            btn.classList.add("correct");
            if (mode === "test") testScore += 5; // 5 –±–∞–ª—ñ–≤ –∑–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É
          } else {
            btn.classList.add("wrong");
            [...div.children].forEach(b => {
              if (b.textContent === word.ua) {
                b.classList.add("correct");
              }
            });
          }
          updateStats();
          updateProgress();
          if (mode === "normal") {
            setTimeout(newQuestion, 1200);
          } else {
            testIndex++;
            setTimeout(newQuestion, 1200);
          }
        };
        div.appendChild(btn);
      });

      document.getElementById("skipBtn").onclick = () => {
        skipped++;
        attempts++;
        if (mode === "normal") currentIndex++;
        else testIndex++;
        updateStats();
        updateProgress();
        newQuestion();
      };

      document.getElementById("resetBtn").onclick = () => {
        score = 0;
        attempts = 0;
        skipped = 0;
        currentIndex = 0;
        localStorage.removeItem("quizStats");
        updateStats();
        updateProgress();
        newQuestion();
      };

      document.getElementById("modeBtn").onclick = () => {
        startTest();
      };
    }

    function startTest() {
      mode = "test";
      testWords = [...words].sort(() => Math.random() - 0.5).slice(0, 20);
      testIndex = 0;
      testScore = 0;
      document.getElementById("testResult").textContent = "";
      updateProgress();
      newQuestion();
    }

    function finishTest() {
      const resultText = `–í–∏ –Ω–∞–±—Ä–∞–ª–∏ ${testScore} –±–∞–ª—ñ–≤ —ñ–∑ 100. ` +
        (testScore >= 65 ? "‚úÖ –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω–æ!" : "‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –±–∞–ª—ñ–≤.");
      document.getElementById("testResult").textContent = resultText;
      mode = "normal"; // –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ—Å—å —É –∑–≤–∏—á–∞–π–Ω–∏–π —Ä–µ–∂–∏–º
      currentIndex = 0;
      updateProgress();
    }
  </script>
</body>
</html>
